## Reusable Flows with Subflows

Another feature of Kestra are Subflows. Often core business logic needs to be repeated in several places which would require us to break the DRY (Don't repeat yourself) principle. It'd be harder to maintain since a change to the logic needs to be made in several places.

Additionally, we often want to have a more modular separation where on flow orchestrates multiple subtasks to do certain things. 

In both cases, Subflows allow us to split and reuse our logic.

Here is how to use Subflows:
1. Create your subflow that will get some orders data from a CSV via https.
```yaml
id: critical_service
namespace: dev.testing
tasks:
  - id: return_data
    type: io.kestra.plugin.jdbc.duckdb.Query
    sql: |
      INSTALL httpfs;
      LOAD httpfs;
      SELECT sum(total) as total, avg(quantity) as avg_quantity
      FROM read_csv_auto('https://huggingface.co/datasets/kestra/datasets/raw/main/csv/orders.csv', header=True);
    store: true
outputs:
  - id: some_output
    type: STRING
    value: "{{ outputs.return_data.uri }}"
```
2. Create your parent flow that uses the subflow and logs the output.
```yaml
id: parent_service
namespace: dev.testing

tasks:
  - id: subflow_call
    type: io.kestra.plugin.core.flow.Subflow
    namespace: dev.testing
    flowId: critical_service
    wait: true
    transmitFailed: true
  - id: log_subflow_output
    type: io.kestra.plugin.scripts.shell.Commands
    taskRunner:
      type: io.kestra.plugin.core.runner.Process
    commands:
      - cat "{{ outputs.subflow_call.outputs.some_output }}"
```
3. Execute the parent flow (`parent_service`) which will generate an output file and also log the values to the console.

A few things to note here:
- The parent flow waits for the subflow to be finished before proceeding to the task `log_subflow_output`. You can also let them run at the same time with `wait: false`. But in this case this makes obviously no sense.
- The shown text for your subflow task can differ from it's name. In the Kestra UI, the `id` property will be shown, while the `flowId` is the actual reference to the subflow.
- In the example, if the referenced subflow fails, the parent flow will also stop working (see `transmitFailed`). This can be changed, if later tasks don't require the previous flows to succeed. However, if set to true, then you also need `wait` to be set to true.

ðŸ‘‰ More info about [Subflows](https://kestra.io/docs/workflow-components/subflows). 
